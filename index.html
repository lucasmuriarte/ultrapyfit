<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultrapyfit documentation &mdash; ultrapyfit 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ultrapyfit" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> ultrapyfit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Package documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">ultrapyfit</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">ultrapyfit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Ultrapyfit documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ultrapyfit-documentation">
<h1>Ultrapyfit documentation<a class="headerlink" href="#ultrapyfit-documentation" title="Permalink to this headline"></a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="disclaimer-of-warranty">
<h2>Disclaimer of Warranty<a class="headerlink" href="#disclaimer-of-warranty" title="Permalink to this headline"></a></h2>
<blockquote>
<div><p>The package is ready to use and stable, and has been used previously for analyzing real datasets.
In case there is any error the authors of the package are not responsible for any user use:
That is to say: THERE IS NO WARRANTY FOR THE PROGRAM, and users are responsible for checking
and verifying their results.</p>
</div></blockquote>
</section>
</section>
<section id="ultrapyfit">
<h1>ultrapyfit<a class="headerlink" href="#ultrapyfit" title="Permalink to this headline"></a></h1>
<hr class="docutils" />
<section id="the-study-of-photochemical-reactions">
<h2>The Study of photochemical reactions<a class="headerlink" href="#the-study-of-photochemical-reactions" title="Permalink to this headline"></a></h2>
<p>The study of photochemical reactions has been an intense field of research where two main questions can be pointed out: how to follow ultrafast dynamics and how to characterize precisely the nature of intermediates. Chemical reactions occur via transient excited states or reaction intermediates which are short-living species that play a major role in the reactions. The goal is to build a photo-dynamical scheme, i.e. to determine the nature of the different short-living transient species, their lifetime, their rate constant and the different pathways with their formation yield. The final target is then to find which parameters control the properties of interest (for example for rhodopsin the switching yield) in order to design efficient new bio-materials. The classical method is to use time-resolved spectroscopy which consists in measuring spectra while the photoreaction is occurring.</p>
<p>Time-resolved techniques are often based on a pump pulse (shorter than the dynamics to be studied) that triggers photophysical processes and photochemical reactions, and a probe beam (continuous or pulsed, depending on the technique) that will analyze the dynamics of the systems after the photo-excitation. The most represnetative technique is to use as probe a UV-Vis beam (TRUV-Vis), and to meassure the absorbance with and without laser excitation, and calculate the difference. Therefore the difference absorption spectra can be positive or negative related to the appearance of new absorbing intermediate species and photoproducts and disappearance of the initial products. In TRUV-vis spectroscopy, negative and positive difference spectra are the result of different contributions: Ground state bleaching or depopulation bands (GSB) and stimulated emission bands (SE) which are negative signals, and induced absorption which is positive. These signals can be seen in Figure 1 for TRUV-vis and TRIR experiments. While induced absorption and GSB are common for TRUV-vis and TRIR, SE is specific for TRUV-vis measurements.</p>
<p><span class="raw-html-m2r"><img src="./resources/figure_1_readme.png" style="width:900px;height:300px;"/></span></p>
<caption><center><font color='purple'><b>Figure 1. Hypothetic pump-probe TR signal recorded at 1.2 ps a)TRUV-Vis probe. b)TRIR probe. </font></center></caption><p>TR spectroscopies often consist on detecting with a probe changes in absorption of the sample provoked by another laser pulse (the pump) over times with a stroboscopic or continuous detection. Thus, the resulting signal is a multivariate, with a first independent variable wavelength (UV-Vis) or wavenumber (IR), and a second independent variable being the time delay between pump and probe. In other words, a time-resolved data set is a collection of measurements done at different (distinct) times and wavelengths. The evolution of the absorption in time for the different wavelengths contains information such as reaction kinetics and molecular changes.</p>
<p>To unravel the chemical reactions and processes behind the multivariate data, model-based analysis of the data is mandatory. The most straightforward approach to model a photochemical reaction is to assume that the concentration of transient species or reaction rate is the sum of independent species (Beer-Lambert law) and only depends on the concentration of these species (first-order reaction). The integration of a first order reaction can be described by exponential decay. According to this hypothesis, the data should be explained by a weighted sum of exponential functions, where every exponential time constant represents the decay of a transient species that follow a first-order reaction, and the pre-exponential value or weight, represents the concentration of this species.</p>
<p>The most simple approach to unravel the dynamics under the data is to fit the data to a wegithed sum of exponential to the kinetic traces recorded at one wavelength. This can yield an estimation of the number of transient species involved in the reaction and their decay constants. Nevertheless, the ambiguity of multi-expoential fitting is well known. One of the most established approaches to analyze the different absorption spectra is to fit the time evolution for several wavelengths with the same sum of exponentials. This approach has been demonstrated to be much more robust and accurate than a separate or single wavelength analysis and is typically known as global fit analysis. Furthermore, from a global analysis of the data, not only the number of transient species and their decay time constants can be obtained but also their decay associated spectral shapes. These are obtained from the weights of each exponentials associated to a species at each of the wavelengths, which constitute the so call Decay Associated Spectra (DAS).</p>
<p>More complex analysis can be done if the data is fitted to a specific kinetic model with rate constants; this is known as target analysis or chemical reaction modelling66. Kinetic models are for example a cascade model in which the species evolve from one to the next one sequentially with 100% quantum yield efficiency, or it can be more complex kinetic models (parallel pathway) were the conversion yields between the different species and pathways can be fixed with known external parameters as photoconversion quantum yields. The result of such an analysis can give the so-called evolving associated difference spectra (EADS), which can yield a more comprehensive picture with rate constants of the different pathways of the photoreaction and not only time constants of species in DAS analysis.</p>
</section>
</section>
<section id="the-ultrapyfit-package">
<h1>The ultrapyfit package<a class="headerlink" href="#the-ultrapyfit-package" title="Permalink to this headline"></a></h1>
<p>The Experiment class is a wrapper over Ultrapyfit entire packge that simplifies the process and allow to eassilly format and explore data and generate high quality Figures.</p>
<p>The first thing is to load the data:</p>
<p>``
path = “my_path.csv”</p>
<p>experiment = Experiment.load_data(path)
``</p>
<p>in cases where the wavelenght vector correspond to the rows</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment</span> <span class="pre">=</span> <span class="pre">Experiment.load_data(path,</span> <span class="pre">wave_is_row=True)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ultrapyfit.experiment</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/denoised.csv&quot;</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">wave_is_row</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The firts thing is to get to know our data the best option is:</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.describe_data()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">describe_data</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">data</span> <span class="n">description</span>
<span class="o">--------------------------</span>
    <span class="n">Data</span> <span class="nb">set</span>        <span class="n">Nº</span> <span class="n">traces</span>   <span class="n">Nº</span> <span class="n">spectra</span>
    <span class="n">Loaded</span> <span class="n">data</span><span class="p">:</span>     <span class="mi">301</span>            <span class="mi">66</span>
    <span class="n">Current</span> <span class="n">data</span><span class="p">:</span>    <span class="mi">301</span>            <span class="mi">66</span>
    <span class="n">Selected</span> <span class="n">traces</span><span class="p">:</span> <span class="mi">301</span>

     <span class="n">units</span>
<span class="o">---------------</span>
    <span class="n">Time</span> <span class="n">unit</span><span class="p">:</span> <span class="n">ps</span>
    <span class="n">Wavelength</span> <span class="n">unit</span><span class="p">:</span> <span class="n">nm</span>
</pre></div>
</div>
<p>We can see we have 66 spectra (time points) and 301 time traces (wavelenght recorded); we can also see the defined units is the wavelenght or energy  vector is in “nm” and time vector in “ps”.</p>
<p>These can be change wiht the attributes <strong>time_unit</strong> and <strong>wavelength_unit</strong>, are used to format figures axes and legends automatically</p>
</section>
<section id="defining-time-units">
<h1>Defining time units<a class="headerlink" href="#defining-time-units" title="Permalink to this headline"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># these expressions are all equivalent</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;ns&quot;</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;nano&quot;</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;nanosecond&quot;</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">time_unit</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ns&#39;</span>
</pre></div>
</div>
<p>For the moment we will keep th time in “ps”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;ps&quot;</span>
</pre></div>
</div>
<p>The first thig is to explore the data three methods can become handy:</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.plot_3D()</span>
<span class="pre">experiment.plot_spectra()</span>
<span class="pre">experiment.plot_traces()</span></code></p>
</section>
<section id="plotting-data">
<h1>Plotting data<a class="headerlink" href="#plotting-data" title="Permalink to this headline"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">plot_3D</span><span class="p">()</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_13_0.png"></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_14_2.png"></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_15_2.png"></span></p>
<p>As we can see from the above figures all traces and spectra are plotted. The plot_spectra method is can be easilly used to plot a slection of spectra fast.
<code class="docutils literal notranslate"><span class="pre">experiment.plot_spectra(&quot;auto&quot;)</span></code></p>
<p>This will plot 8 spectra equally spaced at the wavelength where the signal is maximum (in this case 1520 nm). For data where the signal initially increase or is not maximum at time 0 (not this case) you can use the option from_max_to_min
<code class="docutils literal notranslate"><span class="pre">experiment.plot_spectra(&quot;auto&quot;,</span>&#160; <span class="pre">from_max_to_min=False)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1520.0</span>
<span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_17_2.png"></span></p>
<p>The plot_spectra method is can be easilly used to plot a slection of spectra fast.</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.plot_spectra([&quot;auto&quot;,</span> <span class="pre">num_spectra,</span> <span class="pre">equally_spaced_at])</span></code></p>
<p>The following command willl plot 6 spectra equally spaced 1440 nm</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.plot_spectra([&quot;auto&quot;,</span> <span class="pre">6,</span> <span class="pre">1440])</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">([</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1440</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1440.0</span>
<span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_19_2.png"></span></p>
<p>Any valid maptlotlib style can be used just by passing to any plot method the argument style. If not there are several styles defined using maptlotlib style sheet which are equally accesible, alternatively a style can be defined in a json file as a sum of several maptlotlib styles, where a maptlotlib plotting function can be added as part of the style.</p>
<p>To define a user style just follow matplotlib gideline. By default the styles are <strong>“lmu_spec”</strong>, for spectra <strong>“lmu_trac”</strong> for traces, and <strong>“lmu_res”</strong> for the fits. All have a dark version by adding a <strong>d</strong> at the end <strong>“lmu_specd”</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1520.0</span>
<span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_21_2.png"></span></p>
<section id="color-map">
<h2>color map<a class="headerlink" href="#color-map" title="Permalink to this headline"></a></h2>
<p>Any matplotlib coolor map is valid, this can be set using:
<code class="docutils literal notranslate"><span class="pre">experiment.set_color_map(&quot;color_map&quot;)</span></code></p>
<p>The color map can be obtain
<code class="docutils literal notranslate"><span class="pre">experiment.get_color_map(&quot;color_map&quot;)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">set_color_map</span><span class="p">(</span><span class="s2">&quot;OrRd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an exmaple of plotting a figure with a dark style using “lmu_specd”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;lmu_specd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1520.0</span>
<span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_25_2.png"></span></p>
</section>
</section>
<section id="number-of-components-in-the-data-singular-value-deocomposition-svd">
<h1>Number of components in the data; Singular Value Deocomposition (SVD)<a class="headerlink" href="#number-of-components-in-the-data-singular-value-deocomposition-svd" title="Permalink to this headline"></a></h1>
<p>In practice, the selection of the number of species/components (number of exponential time constants in DAS) is not straightforward, as a higher number of components will always fit better the data set, without necessarily describing better the photophysical model. The literature on similar systems can help in this step. Then a first visual analysis of the transient absorption spectra evolutions is already giving the main temporal and spectral evolutions. Finally, mathematical methods such as singular value decomposition (SVD) can also help. The SVD is a matrix factorization technique that decomposes the data (M) in three simpler matrices U, S and V (Equation 2).
<span class="raw-html-m2r"><br /></span></p>
<p>$$M=U×S×V^T$$    <span class="raw-html-m2r"><div style="text-align: right"> Equation 2. </div></span></p>
<p><span class="raw-html-m2r"><br /></span>
Where U and V are the left and right singular vectors and S a diagonal matrix containing the singular values, the number of non-zero singular values is the rank or the minimum number of components that describes the data set M. Nevertheless, due to inevitably noisy data, the selection of non-zero singular values can be tricky. As can be seen, the selection of components is not trivial, and usually, several tests are done by adding or subtracting one component in the analysis, to find the minimum number of components that correctly describes the data. Once a model has been chosen, we try to describe the data with it (fitting), which consists in varying the model parameters iteratively until a set of parameters that describes the data is found.</p>
<p>To explore the SVD decomposition two methods ar available in the package, the first one in matplotlib is not use %inline will pop out an interactive figure.</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.plot_full_SVD(3)</span>
<span class="pre">experiment.plot_singular</span> <span class="pre">_values()</span></code></p>
<p>Since the data has been generated with 3 components and no noise has been added we can see that clearly 3 we obtain non-zero singular values</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">plot_full_SVD</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_28_0.png"></span></p>
</section>
<section id="fitting">
<h1>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline"></a></h1>
<section id="fitting-a-simple-exponential-model">
<h2>Fitting a simple exponential model<a class="headerlink" href="#fitting-a-simple-exponential-model" title="Permalink to this headline"></a></h2>
<p>As mentioned above, the most simple approach to model a photochemical reaction is to assume that the concentration of transient species or reaction rate follows a first-order reaction. According to this hypothesis, the data should be explained by a weighted sum of exponential functions, where every exponential time represents the decay of a transient species that follow a first-order reaction, and the pre-exponential value or weight is the concentration of this species. Logically, fitting one of the kinetic traces records at one wavelength can yield an estimation of the number of transient species involved in the reaction and their decay constants.</p>
<p>Fitting a single expoential wavelenght is quite straightforward in ultrapyfit</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.fitting.fit_single_exp(wavelength,</span> <span class="pre">average,</span> <span class="pre">t0,</span> <span class="pre">fwhm,</span> <span class="pre">taus,</span> <span class="pre">plot=True)</span></code></p>
<p>this will automatically plot out the result obtained, wiht the residues and the optimzed values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">fit_single_exp</span><span class="p">(</span><span class="mi">1520</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Preparing</span> <span class="n">Fit</span>
<span class="n">Starting</span> <span class="n">Fit</span>
<span class="n">style</span> <span class="n">applied</span>
<span class="kc">False</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_32_2.png"></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">fit_single_exp</span><span class="p">(</span><span class="mi">1480</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Preparing</span> <span class="n">Fit</span>
<span class="n">Starting</span> <span class="n">Fit</span>
<span class="n">style</span> <span class="n">applied</span>
<span class="kc">False</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_33_2.png"></span></p>
<p>Note the values of the residues are 1e-11 wich is the values given to stop the optimization.</p>
<p><strong>REMEMBER</strong> you always have access to previous fits perform using</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.fitting.plot_single_fit(fit_number)</span></code></p>
</section>
<section id="globallly-fitting-a-simple-exponential-model">
<h2>Globallly Fitting a simple exponential model<a class="headerlink" href="#globallly-fitting-a-simple-exponential-model" title="Permalink to this headline"></a></h2>
<p>For cases wiht high signal to noise ration (S/N), fitting a single wavelength might result in good fitting values, Nevetherless, the model ambiguity is a well known issue in multi-exponential fitting (in this case we have used 3 exponentials). One of the most established approaches to  overcome the multi-exponential fitting model ambiguity is to analyze a certain number of selected traces (multi wavelengths) with the same sum of exponentials. This approach, typically known as global analysis, has been demonstrated to be much more robust and accurate than separate or single wavelength analysis. Furthermore, from a global analysis of the data, not only the decay time constants and number of transient species can be obtained, but also their spectral shapes from the weights (pre-exponential factor) of the sum of exponential at each of the wavelengths, which constitute the so call Decay Associated Spectra (DAS).</p>
<p>For this in ultrapyfit, we first need to select a sub-set of traces in case we have many this is done with:</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.select_traces(points=3,</span> <span class="pre">average=1)</span></code></p>
<p>Since we have one trace per nm the above command will select one trace every 3 nanometers, and will average to +- 1 traces</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">select_traces</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">describe_data</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">data</span> <span class="n">description</span>
<span class="o">--------------------------</span>
    <span class="n">Data</span> <span class="nb">set</span>        <span class="n">Nº</span> <span class="n">traces</span>   <span class="n">Nº</span> <span class="n">spectra</span>
    <span class="n">Loaded</span> <span class="n">data</span><span class="p">:</span>     <span class="mi">301</span>            <span class="mi">66</span>
    <span class="n">Current</span> <span class="n">data</span><span class="p">:</span>    <span class="mi">301</span>            <span class="mi">66</span>
    <span class="n">Selected</span> <span class="n">traces</span><span class="p">:</span> <span class="mi">100</span>

     <span class="n">units</span>
<span class="o">---------------</span>
    <span class="n">Time</span> <span class="n">unit</span><span class="p">:</span> <span class="n">ps</span>
    <span class="n">Wavelength</span> <span class="n">unit</span><span class="p">:</span> <span class="n">nm</span>
</pre></div>
</div>
<p>Once the data has been selected we need to initialize the initial guess before fitting</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.fitting.initialize_exp_params(t0,</span> <span class="pre">fwhm,</span> <span class="pre">*taus)</span></code></p>
<p>Once the parameters have been initialized we can perfomr a global fit. This is the same multi-exponential fitting perfomr previously to the 1520 nm traces but now perform to 100 traces where the decay times have the contraint to be the same for all the traces.</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.fitting.fit_global()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">initialize_exp_params</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">fit_global</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Preparing</span> <span class="n">Fit</span>
<span class="n">Starting</span> <span class="n">Fit</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">1.8655294315171926</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">1.8655294317608768</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.8306947330449641</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.83069473306919</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.4912077152559998</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.49120771526086043</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">1400</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.011932706604909027</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">1600</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">0.01193270660579272</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">1.4951380112398673e-05</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">1.4951380112305695e-05</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">2200</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">7.417861413160876e-08</span>
<span class="n">Iteration</span><span class="p">:</span> <span class="mi">2400</span><span class="p">,</span> <span class="n">chi2</span><span class="p">:</span> <span class="mf">7.41786141321848e-08</span>
</pre></div>
</div>
<p><strong>DONE</strong> Fit has been performed</p>
<p>The fits are very eassy to explore three methods are available:</p>
<p><code class="docutils literal notranslate"><span class="pre">experiment.fitting.print_fit_results()</span>
<span class="pre">experiment.fitting.plot_global_fit()</span>
<span class="pre">experiment.fitting.plot_DAS()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">print_fit_results</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fit</span> <span class="n">number</span> <span class="mi">1</span><span class="p">:</span>   <span class="n">Global</span> <span class="n">Exponential</span> <span class="n">fit</span>
<span class="o">-------------------------------------------------</span>
<span class="n">Results</span><span class="p">:</span>    <span class="n">Parameter</span>       <span class="n">Initial</span> <span class="n">value</span>   <span class="n">Final</span> <span class="n">value</span>     <span class="n">Vary</span>
            <span class="n">time</span> <span class="mi">0</span><span class="p">:</span>         <span class="mf">0.0000</span>          <span class="mf">0.0000</span>          <span class="kc">False</span>
            <span class="n">tau</span> <span class="mi">1</span><span class="p">:</span>          <span class="mf">0.8000</span>          <span class="mf">1.0000</span>          <span class="kc">True</span>
            <span class="n">tau</span> <span class="mi">2</span><span class="p">:</span>          <span class="mf">5.0000</span>          <span class="mf">8.0000</span>          <span class="kc">True</span>
            <span class="n">tau</span> <span class="mi">3</span><span class="p">:</span>          <span class="mf">50.0000</span>         <span class="mf">30.0000</span>         <span class="kc">True</span>
<span class="n">Details</span><span class="p">:</span>
        <span class="n">Nº</span> <span class="n">of</span> <span class="n">traces</span><span class="p">:</span> <span class="mi">100</span><span class="p">;</span> <span class="n">average</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">Fit</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">exponential</span><span class="p">;</span> <span class="n">Deconvolution</span> <span class="kc">False</span>
        <span class="n">Tau</span> <span class="n">inf</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">2426</span>
        <span class="n">Number</span> <span class="n">of</span> <span class="n">parameters</span> <span class="n">optimized</span><span class="p">:</span> <span class="mi">800</span>
        <span class="n">Weights</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">plot_global_fit</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_43_2.png"></span></p>
<p>If a specific wavelength fitted want to be check</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">plot_global_fit</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="p">[</span><span class="mi">1390</span><span class="p">,</span> <span class="mi">1480</span><span class="p">,</span> <span class="mi">1520</span><span class="p">,</span> <span class="mi">1580</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_45_2.png"></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">plot_DAS</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">False</span>
<span class="n">style</span> <span class="n">applied</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><img src="./resources/output_46_2.png"></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Package documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">ultrapyfit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ultrapyfit.html">ultrapyfit package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ultrapyfit.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ultrapyfit.fit.html">ultrapyfit.fit package</a><ul>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#submodules">Submodules</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit.GlobalFit">ultrapyfit.fit.GlobalFit module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#ultrapyfit-fit-globalfitbootstrap-module">ultrapyfit.fit.GlobalFitBootstrap module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit.GlobalParams">ultrapyfit.fit.GlobalParams module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit.ModelCreator">ultrapyfit.fit.ModelCreator module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit.jacobian">ultrapyfit.fit.jacobian module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit.targetmodel">ultrapyfit.fit.targetmodel module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.fit.html#module-ultrapyfit.fit">Module contents</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="ultrapyfit.graphics.html">ultrapyfit.graphics package</a><ul>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#submodules">Submodules</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#module-ultrapyfit.graphics.ExploreData">ultrapyfit.graphics.ExploreData module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#module-ultrapyfit.graphics.ExploreResults">ultrapyfit.graphics.ExploreResults module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#module-ultrapyfit.graphics.MaptplotLibCursor">ultrapyfit.graphics.MaptplotLibCursor module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#module-ultrapyfit.graphics.PlotSVD">ultrapyfit.graphics.PlotSVD module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.graphics.html#module-ultrapyfit.graphics">Module contents</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="ultrapyfit.old.html">ultrapyfit.old package</a><ul>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#submodules">Submodules</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.Calibration_Final_QT_2">ultrapyfit.old.Calibration_Final_QT_2 module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.ChirpCorrection">ultrapyfit.old.ChirpCorrection module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.ExponentialFit">ultrapyfit.old.ExponentialFit module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#ultrapyfit-old-global-fit-class-module">ultrapyfit.old.Global_Fit_class module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.TargetFit">ultrapyfit.old.TargetFit module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.basicSpectrum">ultrapyfit.old.basicSpectrum module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.data_containers">ultrapyfit.old.data_containers module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old.targetmodel">ultrapyfit.old.targetmodel module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.old.html#module-ultrapyfit.old">Module contents</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="ultrapyfit.utils.html">ultrapyfit.utils package</a><ul>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.utils.html#submodules">Submodules</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.utils.html#module-ultrapyfit.utils.ChirpCorrection">ultrapyfit.utils.ChirpCorrection module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.utils.html#module-ultrapyfit.utils.Preprocessing">ultrapyfit.utils.Preprocessing module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.utils.html#module-ultrapyfit.utils.divers">ultrapyfit.utils.divers module</a></li>
<li class="toctree-l5"><a class="reference internal" href="ultrapyfit.utils.html#module-ultrapyfit.utils">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ultrapyfit.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="ultrapyfit.html#ultrapyfit-experiment-module">ultrapyfit.experiment module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ultrapyfit.html#module-ultrapyfit">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-right" title="ultrapyfit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Lucas Martinez Uriarte.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>